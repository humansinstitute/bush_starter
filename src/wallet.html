<!DOCTYPE html>
<html lang="en" data-theme="default">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, viewport-fit=cover"
    />
    <title>Cashubash Wallet</title>
    <link rel="stylesheet" href="./ui/plain-skin.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap"
      rel="stylesheet"
    />
  </head>
  <body>
    <!-- Theme hint: Override CSS variables in :root or set data-theme on <html> to adapt brand colors. -->
    <div id="exit-overlay" class="modal-overlay" hidden>
      <div class="modal-card">
        <h2>Disconnect server?</h2>
        <p class="modal-body" id="exit-warning">
          Removing the linked server key will clear balance data for this session.
        </p>
        <div class="modal-actions">
          <button type="button" class="ui-button" id="exit-confirm">Disconnect</button>
          <button type="button" class="ui-button ui-button-secondary" id="exit-cancel">Cancel</button>
        </div>
      </div>
    </div>
    <div id="pubkey-gate" class="modal-overlay" hidden>
      <div class="modal-card">
        <h2>Add server access</h2>
        <p class="modal-body">Paste the server pubkey to connect this wallet session.</p>
        <form id="pubkey-form" class="form" autocomplete="off">
          <label class="form-field" data-required>
            <span>Server pubkey</span>
            <input
              type="text"
              id="pubkey-input"
              name="serverPubkey"
              placeholder="npub1..."
              required
              spellcheck="false"
            />
          </label>
          <button type="submit" class="ui-button" id="pubkey-submit">Connect</button>
          <p id="pubkey-hint" class="form-hint">Provide the Cashubash server key to load balances.</p>
          <output id="pubkey-error" class="form-error" role="alert"></output>
        </form>
      </div>
    </div>
    <main class="wallet-shell">
      <header class="wallet-header">
        <div class="wallet-heading">
          <h1>Cashubash Wallet</h1>
          <p class="tagline">Lightning treasury overview</p>
        </div>
        <div class="header-meta">
          <div class="balance-panel">
            <span class="panel-label">Balance</span>
            <span id="balance-display" class="balance-value">-- sats</span>
          </div>
          <p class="status-line" id="status-line">Loading balanceâ€¦</p>
        </div>
        <button type="button" id="exit-button" class="ui-button ui-button-secondary exit-button">
          Disconnect server
        </button>
      </header>

      <section class="wallet-grid">
        <article class="card" data-card="make-invoice">
          <div class="card-heading">
            <h2>Create invoice</h2>
            <p>Generate a Lightning invoice for incoming payments.</p>
          </div>
          <form id="make-invoice-form" class="form" autocomplete="off">
            <label class="form-field" data-required>
              <span>Amount (sats)</span>
              <input
                type="number"
                name="amount"
                min="1"
                step="1"
                placeholder="1000"
                required
              />
            </label>
            <button type="button" class="text-button more-toggle" data-target="make-invoice-more">
              More options
            </button>
            <div class="more-fields" id="make-invoice-more" hidden>
              <label class="form-field">
                <span>Description</span>
                <input
                  type="text"
                  name="description"
                  maxlength="128"
                  placeholder="Reference"
                />
              </label>
              <label class="form-field">
                <span>Expiry (seconds)</span>
                <input
                  type="number"
                  name="expiry"
                  min="60"
                  step="60"
                  placeholder="600"
                />
              </label>
            </div>
            <button type="submit" class="ui-button">Generate invoice</button>
          </form>
          <div id="invoice-output" class="invoice-output" hidden>
            <canvas id="invoice-qr" class="invoice-qr" aria-hidden="true"></canvas>
            <div class="invoice-details">
              <span class="panel-label">Invoice</span>
              <code id="invoice-string" class="invoice-string"></code>
            </div>
            <button type="button" id="copy-invoice" class="ui-button">
              Copy invoice
            </button>
          </div>
        </article>

        <article class="card" data-card="pay-invoice">
          <div class="card-heading">
            <h2>Pay invoice</h2>
            <p>Send sats to a Lightning invoice.</p>
          </div>
          <form id="pay-invoice-form" class="form" autocomplete="off">
            <label class="form-field" data-required>
              <span>Invoice</span>
              <textarea
                name="invoice"
                rows="3"
                placeholder="BOLT11 details"
                required
              ></textarea>
            </label>
            <div class="form-actions">
              <button type="button" id="scan-invoice" class="ui-button ui-button-secondary">
                Scan invoice
              </button>
              <button type="button" class="text-button more-toggle" data-target="pay-invoice-more">
                More options
              </button>
            </div>
            <div class="more-fields" id="pay-invoice-more" hidden>
              <label class="form-field">
                <span>Amount override (sats)</span>
                <input
                  type="number"
                  name="amount"
                  min="1"
                  step="1"
                  placeholder="Optional"
                />
              </label>
            </div>
            <button type="submit" class="ui-button">Pay invoice</button>
          </form>
          <section id="invoice-scanner-panel" class="scanner-panel" hidden>
            <h3>Scan for invoice</h3>
            <div id="invoice-scanner-view" class="scanner-view" role="img" aria-label="Live camera preview"></div>
            <div class="scanner-actions">
              <button type="button" id="scanner-cancel" class="text-button">
                Cancel
              </button>
            </div>
          </section>
          <output id="pay-invoice-output" class="action-output" role="status"></output>
        </article>

        <article class="card" data-card="send-ecash">
          <div class="card-heading">
            <h2>Send eCash</h2>
            <p>Create a token to share sats securely.</p>
          </div>
          <form id="send-ecash-form" class="form" autocomplete="off">
            <label class="form-field" data-required>
              <span>Amount (sats)</span>
              <input
                type="number"
                name="amount"
                min="1"
                step="1"
                placeholder="500"
                required
              />
            </label>
            <button type="submit" class="ui-button">Mint token</button>
          </form>
          <section id="send-ecash-token-panel" class="token-panel" hidden>
            <label class="form-field">
              <span>Minted token</span>
              <textarea
                id="send-ecash-token"
                readonly
                rows="4"
              ></textarea>
            </label>
            <div class="token-actions">
              <button type="button" id="copy-ecash-token" class="ui-button ui-button-secondary">
                Copy token
              </button>
            </div>
          </section>
          <output id="send-ecash-output" class="action-output" role="status"></output>
        </article>
      </section>
    </main>

    <template id="toast-template">
      <div class="toast"></div>
    </template>

    <script type="module" src="./wallet-frontend.js"></script>
  </body>
</html>
